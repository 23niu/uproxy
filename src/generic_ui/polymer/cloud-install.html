<link rel='import' href='../../bower/core-menu/core-menu.html'>
<link rel='import' href='../../bower/core-overlay/core-overlay.html'>
<link rel='import' href='../../bower/core-signals/core-signals.html'>
<link rel='import' href='../../bower/paper-dropdown/paper-dropdown.html'>
<link rel='import' href='../../bower/paper-dropdown-menu/paper-dropdown-menu.html'>
<link rel='import' href='../../bower/paper-input/paper-input-decorator.html'>
<link rel='import' href='../../bower/paper-item/paper-item.html'>
<link rel='import' href='../../bower/paper-progress/paper-progress.html'>
<link rel='import' href='../../bower/polymer/polymer.html'>
<link rel='import' href='button.html'>
<link rel='import' href='dialog.html'>

<polymer-element name='uproxy-cloud-install'>
  <template>
    <style>
    :host {
      text-align: start;
    }
    /* cogged from invite-user.html, to match social network invite dialogs */
    /* TODO: seems like a lot of duplication */
    uproxy-dialog {
      min-width: 80%;
    }
    uproxy-dialog h1 {
      color: #333;
      font-size: 18px;
      font-weight: normal;
      margin-top: 0;
    }
    uproxy-dialog p {
      color: rgb(160, 160, 160);
      line-height: 18px;
      font-weight: lighter;
      font-size: 12px;
      letter-spacing: 0.5px;
    }
    core-icon[icon=clear] {
      position: absolute;
      top: 15px;
      right: 15px;
      color: rgb(180,180,180);
      cursor: pointer;
    }
    uproxy-button {
      margin: 15px 0px;
    }
    uproxy-button #buttonLogoContainer {
      padding: 0em 0.3em;
    }
    uproxy-button #buttonTextContainer {
      padding: 0.7em 0.9em;
      border-left: 1px solid rgba(255,255,255,0.3);
    }
    paper-item {
      font-size: 12px;
    }
    paper-progress {
      width: 100%;
    }
    </style>

    <!-- TODO: remove this logic from the template -->
    <core-signals on-core-signal-open-cloud-install-dialog='{{ openLoginDialog }}'></core-signals>

    <!-- TODO: use core-pages rather than multiple dialogs -->
    <uproxy-dialog layered='false' backdrop='true' id='regionDialog'>
      <h1>Create a cloud server</h1>
      <core-icon icon='clear' on-tap='{{ closeDialogs }}'></core-icon>
      <p>We can help you create a uProxy cloud server in a country of your choice.</p>
      <p>To get started, please select the region for your server. You should choose the region closest to you to minimize latency.</p>
      <div style='text-align:center;'>
        <paper-dropdown-menu label='Select Region'>
          <paper-dropdown class='dropdown'>
            <!-- TODO: get available regions from digital ocean -->
            <core-menu class='menu' id='regionMenu' valueattr='value' selected='nyc2'>
              <paper-item value='nyc2'>New York</paper-item>
              <paper-item value='sfo1'>San Francisco</paper-item>
              <paper-item value='lon1'>London</paper-item>
              <paper-item value='ams2'>Amsterdam</paper-item>
              <paper-item value='sgp1'>Singapore</paper-item>
              </core-menu>
          </paper-dropdown>
        </paper-dropdown-menu>
      </div>
      <div style='text-align:center;'>
        <uproxy-button raised on-tap='{{ regionTapped }}'>
          <span id='buttonLogoContainer'><core-icon icon='uproxy-icons:Cloud'></core-icon></span>
          <span id='buttonTextContainer'>Choose a region</span>
        </uproxy-button>
      </div>
    </uproxy-dialog>

    <uproxy-dialog layered='false' backdrop='true' id='loginDialog'>
      <h1>Create a cloud server</h1>
      <core-icon icon='clear' on-tap='{{ closeDialogs }}'></core-icon>
      <p>We use Digital Ocean to create your cloud server. When you sign into your account, we will create a new uProxy server that you will have access to 24x7 and, optionally, will be able to share with friends and family.</p>
      <p>Please sign in to your account to create a cloud server.</p>
      <div style='text-align:center;'>
        <uproxy-button raised on-tap='{{ loginTapped }}'>
          <span id='buttonLogoContainer'><core-icon icon='uproxy-icons:Cloud'></core-icon></span>
          <span id='buttonTextContainer'>Sign in to Digital Ocean</span>
        </uproxy-button>
      </div>
    </uproxy-dialog>

    <uproxy-dialog layered='false' backdrop='true' id='installingDialog'>
      <h1>Create a cloud server</h1>
      <p>Your cloud server is being created. This will take several minutes, please bear with us.</p>
      <div>
        <paper-progress indeterminate='true'></paper-progress>
      </div>
      <p>{{ ui.cloudInstallStatus }}</p>
    </uproxy-dialog>

    <!-- Although we should use a uproxy-action-dialog for these two dialogs,
         there is some weirdness mixing uproxy-dialog and uproxy-action-dialog
         in the template in which Polymer opens multiple core-overlays,
         messing up the whole UI when the uproxy-action-dialog closes. -->

    <uproxy-dialog layered='false' backdrop='true' id='successDialog'>
      <h1>Create a cloud server</h1>
      <p>Your cloud server is ready!</p>
      <p>Below is the URL to administer your new server. Copy and paste it into a file and save it somewhere you'll be able to get to it in the future. Think of it as a password: keep it safe and don't share it with anyone you don't trust.</p>
      <p>Once you've saved the URL, open it in your browser to add your new server to your contacts list.</p>
      <div>
        <paper-input-decorator layout vertical>
          <input readonly is='core-input' on-tap='{{ select }}' value='{{ inviteUrl }}' />
        </paper-input-decorator>
      </div>
      <uproxy-button on-tap='{{ closeDialogs }}'>{{ 'OK' | $$ }}</uproxy-button>
    </uproxy-dialog>

    <uproxy-dialog layered='false' backdrop='true' id='failureDialog'>
      <h1>Create a cloud server</h1>
      <p>We're sorry. We couldn't create a cloud server for you at this time.</p>
      <p>It may be a temporary problem. Please try again later.</p>
      <uproxy-button on-tap='{{ closeDialogs }}'>{{ 'OK' | $$ }}</uproxy-button>
    </uproxy-dialog>

  </template>
  <script src='cloud-install.js'></script>
</polymer-element>
