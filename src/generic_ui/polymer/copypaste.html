<link rel='import' href='../../bower/paper-button/paper-button.html'>
<link rel='import' href='bubble.html'>
<link rel='import' href='app-bar.html'>

<polymer-element name='uproxy-copypaste' attributes=''>
  <template>
    <style>
    :host {
      text-align: center;
    }
    p {
      text-align: left;
      margin: 0 0 24px 0;
    }
    textarea {
      margin-bottom: 24px;
    }
    textarea.message {
      width: 80%;
      height: 10em;
    }
    paper-button {
      margin-bottom: 24px;
    }
    #getting, #sharing, #nothing {
      margin: 24px;
    }
    uproxy-app-bar::shadow span {
      font-size: 18px;
    }
    </style>

    <core-signals on-core-signal-copypaste-back='{{ exitMode }}'></core-signals>
    <core-signals on-core-signal-copypaste-init='{{ init }}'></core-signals>

    <uproxy-app-bar disableback='{{ ui.copyPasteState.localGettingFromRemote === GettingState.GETTING_ACCESS || ui.copyPasteState.localSharingWithRemote === SharingState.SHARING_ACCESS }}' on-go-back='{{ handleBackClick }}'>
      <span hidden?='{{ SharingState.NONE === ui.copyPasteState.localSharingWithRemote }}'>
        {{ "SHARE_ONE_TIME" | $$ }}
      </span>
      <span hidden?='{{ SharingState.NONE !== ui.copyPasteState.localSharingWithRemote || GettingState.NONE === ui.copyPasteState.localGettingFromRemote }}'>
        {{ "REQUEST_ONE_TIME" | $$ }}
      </span>
      <span hidden?='{{ SharingState.NONE !== ui.copyPasteState.localSharingWithRemote || !(SharingState.NONE !== ui.copyPasteState.localSharingWithRemote || GettingState.NONE === ui.copyPasteState.localGettingFromRemote) }}'>
        {{ "START_ONE_TIME" | $$ }}
      </span>
    </uproxy-app-bar>

    <uproxy-bubble active='{{ ui.copyPasteError === ui_constants.CopyPasteError.BAD_URL }}' on-closed='{{ dismissError }}' class='error'>
      {{ "ERROR_PARSING_LINK" | $$ }}
    </uproxy-bubble>

    <div id='nothing' hidden?='{{ ui.copyPasteState.localGettingFromRemote !== GettingState.NONE || ui.copyPasteState.localSharingWithRemote !== SharingState.NONE }}'>
      <p>
        {{ "NO_LONGER_GETTING" | $$ }}
      </p>

      <div>
        <paper-button on-tap='{{ startGetting }}'>
          {{ "START_NEW_CONNECTION" | $$ }}
        </paper-button>
      </div>

      <uproxy-bubble active='{{ ui.copyPasteError === ui_constants.CopyPasteError.FAILED }}' on-closed='{{ dismissError }}' class='error'>
        {{ "ERROR_STARTING_CONNECTION" | $$ }}
      </uproxy-bubble>

      <p>{{ "SEND_CONNECTION_LINK" | $$ }}</p>
    </div>

    <div id='getting' hidden?='{{ ui.copyPasteState.localGettingFromRemote === GettingState.NONE || ui.copyPasteState.localSharingWithRemote !== SharingState.NONE }}'>
      <div class='link' hidden?='{{ ui.copyPasteState.localGettingFromRemote !== GettingState.TRYING_TO_GET_ACCESS }}'>
        <p>
          {{ "COPY_CONNECTION_LINK" | $$ }}
        </p>

        <textarea readonly hidden?='{{ !ui.copyPasteGettingMessages.length }}'
          class='message' on-tap='{{ select }}'>https://www.uproxy.org/request/{{ ui.copyPasteGettingMessages | encodeMessage }}</textarea>

        <span class='message-loading' hidden?='{{ ui.copyPasteGettingMessages.length }}'>{{ "LOADING" | $$ }}</span>

        <p>
          {{ "FRIEND_NEEDS_TO_CLICK" | $$ }}
        </p>
      </div>

      <div class='connected' hidden?='{{ ui.copyPasteState.localGettingFromRemote !== GettingState.GETTING_ACCESS }}'>
        <p>{{ "ONE_TIME_SUCCESS" | $$ }}</p>

        <p>
          <span hidden?='{{ ui.copyPastePendingEndpoint === null}}'>
            {{ "START_ONE_TIME_INSTRUCTION" | $$ }}
          </span>
          <span hidden?='{{ ui.copyPastePendingEndpoint !== null}}'>
            {{ "STOP_ONE_TIME_INSTRUCTION" | $$ }}
          </span>
        </p>

        <paper-button raised on-tap='{{ startProxying }}'
            hidden?='{{ ui.copyPastePendingEndpoint === null }}'>
          {{ "START_GETTING" | $$ }}
        </paper-button>

        <paper-button raised class='grey' on-tap='{{ stopGetting }}'
            hidden?='{{ ui.copyPastePendingEndpoint !== null }}'>
          {{ "STOP_GETTING" | $$ }}
        </paper-button>

        <uproxy-bubble active='{{ ui.copyPasteError === ui_constants.CopyPasteError.UNEXPECTED }}' on-closed='{{ dismissError }}'>
          <p>{{ "ONE_TIME_GETTING" | $$ }}</p>
          <p>
            {{ "STOP_ONE_TIME_GETTING_BEFORE_NEW" | $$ }}
          </p>
        </uproxy-bubble>
      </div>
    </div>

    <div id='sharing' hidden?='{{ ui.copyPasteState.localSharingWithRemote === SharingState.NONE }}'>
      <div class='link' hidden?='{{ ui.copyPasteState.localSharingWithRemote !== SharingState.TRYING_TO_SHARE_ACCESS }}'>
        <p>{{ "FRIEND_REQUESTED_ONE_TIME" | $$ }}</p>

        <p>
          {{ "HOW_TO_OFFER_ONE_TIME" | $$ }}
        </p>

        <textarea readonly hidden?='{{ !ui.copyPasteSharingMessages.length }}'
          class='message' on-tap='{{ select }}'>https://www.uproxy.org/offer/{{ ui.copyPasteSharingMessages | encodeMessage }}</textarea>

        <span class='message-loading' hidden?='{{ ui.copyPasteSharingMessages.length }}'>{{ "LOADING" | $$ }}Loading...</span>

        <div>
          <a href='#' on-tap='{{ switchToGetting }}'>{{ "GET_ONE_TIME_INSTEAD" | $$ }}</a>

          <uproxy-bubble active='{{ ui.copyPasteError === ui_constants.CopyPasteError.UNEXPECTED }}' on-closed='{{ dismissError }}'>
            <p>
              {{ "TRYING_TO_SHARE_ONE_TIME" | $$ }}
            </p>

            <p>
              {{ "GET_ONE_TIME_INSTEAD_INSTRUCTION" | $$ }}
            </p>
          </uproxy-bubble>
        </div>

      </div>

      <div class='connected' hidden?='{{ ui.copyPasteState.localSharingWithRemote !== SharingState.SHARING_ACCESS }}'>
        <p>{{ "ONE_TIME_SUCCESS" | $$ }}</p>

        <paper-button raised class='grey' on-tap='{{ stopSharing }}'>{{ "STOP_ONE_TIME_SHARING" | $$ }}</paper-button>

        <uproxy-bubble active='{{ ui.copyPasteError === ui_constants.CopyPasteError.UNEXPECTED }}' on-closed='{{ dismissError }}' class='error'>
          <p>{{ "ONE_TIME_SHARING" | $$ }}</p>

          <p>
            {{ "STOP_ONE_TIME_SHARING_BEFORE_NEW" | $$ }}
          </p>
        </uproxy-bubble>
      </div>
    </div>

  </template>
  <script src='copypaste.js'></script>
</polymer-element>
