<link rel='import' href='../lib/polymer/polymer.html'>
<link rel='import' href='../lib/paper-button/paper-button.html'>
<link rel='import' href='../lib/paper-dialog/paper-action-dialog.html'>
<link rel='import' href='../lib/core-tooltip/core-tooltip.html'>
<link rel='import' href='../lib/core-signals/core-signals.html'>
<link rel='import' href='faq-link.html'>

<polymer-element name='uproxy-troubleshoot'>
  <template>
    <style>
    :host {
      text-align: center;
      font-color: #009688;  /* dark green */
    }
    h1 {
      font-size: 1.5em;
    }
    core-icon[icon="help"],
    core-icon[icon="close"] {
      color: grey;
      opacity: 0.6;
      margin-bottom: 2px;
      -webkit-transition: all 0.23s !important;
      -moz-transition: all 0.23s !important;
      transition: all 0.23s !important;
    }
    core-icon[icon="help"]:hover,
    core-icon[icon="close"]:hover {
      opacity: 1;
    }
    core-icon[icon="help"] {
      height: 15px;
      width: 15px;
    }
    core-icon[icon="close"] {
      float: right;
    }
    paper-button {
      background-color: #009688; /* teal */
      color: white;
      margin-bottom: 3px;
      margin-top: 10px;
    }
    paper-action-dialog {
      top: 20%;
      min-width: 305px;
      z-index: 1002; /* Must be greater than core-overlay-backdrop */
    }
    #analyzeNetwork {
      text-align: center;
      font-size: 14px;
    }
    #analyzedNetwork {
      text-align: left;
    }
    paper-progress::shadow #activeProgress {
      background-color: #009688;
    }
    #confirmSendButton {
      float: right;
    }
    </style>

    <!-- Listen for the 'open-troubleshoot' event, which the user can trigger after proxying fails. -->
    <core-signals on-core-signal-open-troubleshoot='{{ open }}'></core-signals>

    <paper-action-dialog backdrop layered="false" id='troubleshootDialog'>
      <h1>
        Unable to proxy <core-icon icon="close" on-tap='{{ close }}'></core-icon>
      </h1>
      <div hidden?='{{ analyzingNetwork || analyzedNetwork }}'>
        <p>
          Something went wrong. Would you like uProxy to diagnose your network?
          <uproxy-faq-link anchor='doesUproxyLogData'>
            <core-icon icon="help"></core-icon>
          </uproxy-faq-link><br>
        </p>
        <paper-button on-tap='{{ getNatType }}'>
          Analyze Network
        </paper-button>
      </div>
      <div id='analyzeNetwork' hidden?='{{ !analyzingNetwork }}'>
        Analyzing network<br>
        <paper-progress indeterminate='true'></paper-progress>
      </div>
      <div id='analyzedNetwork' hidden?='{{ !analyzedNetwork }}'>
        NAT type detected: <b>{{ natType }}</b> <br>
        This NAT type is <b>{{ natDescription }}</b> restricting your ability to use uProxy.
        <uproxy-faq-link anchor='doesUproxyLogData'>
          <core-icon icon="help"></core-icon>
        </uproxy-faq-link><br><br>
        Would you like to report your NAT type to uProxy developers?
        <br>
        <paper-button dismissive>
          No
        </paper-button>
        <paper-button affirmative on-tap='{{ sendNetworkInfo }}' id='confirmSendButton'>
          Yes
        </paper-button>
      </div>
    </paper-action-dialog>

  </template>
  <script src='troubleshoot.js'></script>
</polymer-element>
